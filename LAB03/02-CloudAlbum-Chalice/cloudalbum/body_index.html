<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Cloud Album::Upload</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Custom styles for this template -->
    <link href="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/css/app.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/bootstrap.bundle.min.js"></script>
    <!-- Google Map API -->
    <script type="text/javascript" type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyAVCE0S8z1TYo52cK9KC6QPcjVLMHGy_b0"></script>
    <!-- Gmaps.js -->
    <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/gmaps.js"></script>

    <!-- bootbox.js -->
    <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/bootbox.min.js"></script>
    <!-- Fontawesome for vectorized icons -->
    <script type="text/javascript" defer src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/all.js"></script>


    <script>
      // AjaxSetup for CSRF working
      var csrf_token = '';

      $.ajaxSetup({
          beforeSend: function(xhr, settings) {
              if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                  xhr.setRequestHeader("X-CSRFToken", csrf_token);
              }
          }
      });


      //customized bootbox.alert function
      function msgbox(msg) {
        bootbox.alert({
            message: msg,
            size: 'small'
        }).find('.modal-content').css({
            'margin-top': function (){
                var w = $( window ).height();
                var b = $(".modal-dialog").height();
                // should not be (w-h)/2
                var h = ((w-b)/2)-50;
                return h+"px";
            }
        });
      }

      //Set alert message timeout
      window.setTimeout(function() {
          $(".alert").fadeTo(700, 0).slideUp(700, function(){
              $(this).remove();
          });
      }, 4000);

      //Message alerting function
      function msgAlert(msg) {
        $("#alert-container").html("<div class=\"alert alert-warning\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n" + msg + "</div>" +
            "<script>      " +
            "window.setTimeout(function() {\n" +
            "          $(\".alert\").fadeTo(500, 0).slideUp(500, function(){\n" +
            "              $(this).remove();\n" +
            "          });\n" +
            "      }, 4000);" +
            "<\/script>");
      }


      //Function for searching
      function search(){

            bootbox.prompt({
                title: "&nbsp;&nbsp;Please enter a search keyword..",
                buttons: {
                    confirm: {
                        label: "<i class='fas fa-search'></i> Search",
                        className: 'btn-secondary'
                    },
                    cancel: {
                        label: 'Cancel',
                        className: 'btn-dark'
                    }
                },
                callback: function (result) {

                    if(result == null || result.length == 0){
                        console.log('search keyword:'+result);
                        msgAlert('Search keyword is empty!');
                    }
                    else{
                        console.log('search keyword:'+result);
                        $('[name=search]').val(result);
                        $('#search-form')
                        .attr('action','/photos/search')
                        .submit();
                    }
                }
            }).find('.modal-content').css({
            'margin-top': function (){
                var w = $( window ).height();
                var b = $(".modal-dialog").height();
                // should not be (w-h)/2
                var h = ((w-b)/2)-100;
                return h+"px";
                }
            });
      }
    </script>


    

  

  <!-- Fileinput plugin -->
  <link rel="stylesheet" href="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/css/jasny-fileinput.css" type="text/css" media="screen" title="CloudAlbum" charset="UTF-8" />
  <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/binaryajax.js"></script>
  <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/exif.js"></script>
  <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/jasny-fileinput.js"></script>
  <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/moment.min.js"></script>

  <script>
    var csrf_token = '';

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });
  </script>





  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="/"><i class="fas fa-images"></i> Cloud Album</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">

            <li class="nav-item">
              <a class="nav-link" href="/users/716b79d4-908d-4817-8d5c-5ad0e40dcb6b/edit"><i class="fas fa-user"></i> <strong>Hello, sungshik</strong></a>
            </li>

            <li class="nav-item">
              <a id="search-input" class="nav-link" href="javascript:search();"><i class="fas fa-search"></i> Search</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/photos/map"><i class="fas fa-map-marker-alt"></i> Map</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/photos/new"><i class="fas fa-upload"></i> Upload</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/users/signout"><i class="fas fa-sign-out-alt"></i> Sign out</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>


    <p>
        <form id="search-form" method="POST">
            <input type="hidden" name="search" id="search" value="">

        </form>

        


    <!-- Page Content -->
    <div class="container-fluid">

      <form id="upload" name="upload" class="form-group" action="#" method="POST" enctype="multipart/form-data">

       <!-- for CSRF -->
        <input type="hidden" name="csrf_token" value=""/>

        <div id="alert-container">
        </div>

        <div class="row col-md-12">
          <div class="col-md-5 card bg-light p-3">

              <div class="fileinput fileinput-new" data-provides="fileinput">

                
                    <!-- upload mode -->
                    <div class="fileinput-preview thumbnail rounded" data-trigger="fileinput" style="background-color:lightgray;width: 200px; height: 150px;"></div>
                    <div>
                        <span class="btn btn-outline-secondary btn-file">
                            <span class="fileinput-new"><strong><i class="fas fa-folder-open"></i> Select image</strong></span>
                            <span class="fileinput-exists"><strong><i class="fas fa-exchange-alt"></i> Change</strong></span>
                            <input id="photo" name="photo" type="file">
                              <!--  <input id="photo" name="photo" type="file" /> -->
                        </span>
                        <a href="#" onClick="$('#exif-info').html('');" class="btn btn-default fileinput-exists" data-dismiss="fileinput">
                            <strong><i class="fas fa-trash-alt"></i> Remove</strong>
                        </a>
                    </div>
                

                <div id="exif-info">
                </div>
              </div>

              <div>
                <p>
                    <div class="form-label-group">
                      <label for="Tags"><i class="fas fa-tags"></i> Tags</label>
                      <input type="tags" id="tags" name="tags" class="form-control" placeholder="Tags separated by comma"
                             
                             required autofocus>
                    </div>
                </p>
                <p>
                  <div class="form-group">
                    <label for="Description"><i class="fas fa-comments"></i> Description</label>
                    <textarea id="desc" name="desc" class="form-control" placeholder="Description" required></textarea>
                    </div>
                </p>
                    <div class="form-group">
                        
                            <button class="btn btn-lg btn-dark btn-block" type="submit">
                                   <i class="fas fa-upload"></i> Upload
                            </button>
                        
                    </div>
                </p>
              </div>
            </div>
              <div class="col-md-7 card bg-light p-3">
                <div class="form-group col-md-12">
                    <div class="input-group">
                      <input id="address" name="address" type="text" class="form-control" placeholder="Where I took the photo" aria-label="Enter address">
                      <div class="input-group-append">
                        <button id="address-search" class="btn btn-outline-secondary" type="button" onClick="gmapSearch();"><i class="fas fa-search"></i> Search</button>
                        <button id="currentLocation-btn" class="btn btn-outline-secondary" type="button" onClick="currentLocation();"><i class="fas fa-location-arrow"></i> Current Location</button>
                      </div>
                    </div>
                    <p>
                      <div id="map" class="popin"></div>
                      <div id="address-info"></div>
                    </p>
                </div>
          </div>

        </div>
            <input id="lat" name="lat" type="hidden" value="">
            <input id="lng" name="lng" type="hidden" value="">
            <input id="taken_date" name="taken_date" type="hidden" value="">
            <input id="make" name="make" type="hidden" value="">
            <input id="model" name="model" type="hidden" value="">
            <input id="width" name="width" type="hidden" value="">
            <input id="height" name="height" type="hidden" value="">
            <input id="city" name="city" type="hidden" value="">
            <input id="nation" name="nation" type="hidden" value="">
            <input id="formatted_address" name="formatted_address" type="hidden" value="">
      </form>


    </div>
    <!-- /.container -->

    <script>
      var initial_lat = 37.565467;
      var initial_lng = 126.975431;

      var map = new GMaps({
          zoom : 17,
          div: '#map',
          lat: initial_lat,
          lng: initial_lng
        });

      map.addMarker({
          lat: initial_lat,
          lng: initial_lng
      });


      
          //currentLocation();
          msgAlert('Initial geolocation is \<strong\>Deoksugung, Seoul\<\/strong\>. Please set up location information.');
          getReverseGeocodingData(initial_lat, initial_lng, false);
      



      


    </script>

    <script type="text/javascript" src="http://s3-ap-southeast-1.amazonaws.com/aws-chalice-workshop/static/js/app.js"></script>





    </p>

    <footer class="footer bg-dark">
      <div class="container">
        <span class="text-muted">Copyright &copy; CloudAlbum 2018</span>
      </div>
    </footer>


  </body>
</html>